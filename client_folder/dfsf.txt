vimport socket
import sys
import os
import shutil
import posixpath
import ntpath
from pathlib import Path
from collections import namedtuple
from datetime import datetime

#Establish Connection
s = socket.socket()
#host = input(str("Please enter server host address: "))
host = "DESKTOP-MEDSG9I"
port = 420
s.connect((host,port))
print("Connected, file sysnc operational")

#File data structure 
Files = namedtuple('File', 'name path size modified_date')
files1 = []
files2 = []
p = Path(r'C:\Users\onayo\Desktop\file_transfer_over_ip\client_folder')

c = 0

#Send files
def sendfiles(files):
    #Send file name and extension
    sendname = files.name
    print(sendname)
    s.send(bytes(sendname, "utf-8"))
    
    #Send file oject
    fp = files.path
    print(fp)
    #namepath = fp + "\\" + sendname
    
    files = open(sendname, 'rb')
    file_data = files.read(2048)
    s.send(file_data)
    print("Data transmitted successfully")

while (1==1):
    #Loop through files
    for item in p.glob('**/*'):
        name = item.name
        path = Path.resolve(item).parent
        size = item.stat().st_size
        modified = datetime.fromtimestamp(item.stat().st_mtime)

        #Add file to file list
        files1.append(Files(name, path, size, modified))


        #Detect changes to files
        if files1[c] in files2:
            #If change in existing file is not detected
            if (files1[c].modified_date == files2[c].modified_date):     
                print("No changes detected")
            #If change in exsiting file is detected 
            else:   
                sendfiles(files1[c])
        else:
            print("Changes detected")
            files2.append(files1[c])
            sendfiles(files1[c])
        c+=1
    c=0



    
    




#If changes detected, send files to server

